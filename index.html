<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PIPM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="shortcut icon" href="logo.png" type="image/x-icon" />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css"
    />
    <script>
      // Burger menus
      document.addEventListener("DOMContentLoaded", function () {
        // open
        const burger = document.querySelectorAll(".navbar-burger");
        const menu = document.querySelectorAll(".navbar-menu");

        if (burger.length && menu.length) {
          for (var i = 0; i < burger.length; i++) {
            burger[i].addEventListener("click", function () {
              for (var j = 0; j < menu.length; j++) {
                menu[j].classList.toggle("hidden");
              }
            });
          }
        }

        // close
        const close = document.querySelectorAll(".navbar-close");
        const backdrop = document.querySelectorAll(".navbar-backdrop");

        if (close.length) {
          for (var i = 0; i < close.length; i++) {
            close[i].addEventListener("click", function () {
              for (var j = 0; j < menu.length; j++) {
                menu[j].classList.toggle("hidden");
              }
            });
          }
        }

        if (backdrop.length) {
          for (var i = 0; i < backdrop.length; i++) {
            backdrop[i].addEventListener("click", function () {
              for (var j = 0; j < menu.length; j++) {
                menu[j].classList.toggle("hidden");
              }
            });
          }
        }
      });
    </script>
  </head>
  <body>
    <nav class="relative px-4 py-4 flex justify-between items-center bg-white">
      <img class="w-16 rounded-full" src="logo.png" alt="Dhavya" />
      <a href="index.html" class="flex items-center">
        &nbsp; &nbsp; &nbsp;
        <span
          class="self-center whitespace-nowrap text-2xl font-semibold text-transparent bg-clip-text bg-gradient-to-r to-emerald-600 from-sky-400"
          >PIPM Attendance</span
        >
      </a>
      <div class="lg:hidden">
        <button class="navbar-burger flex items-center text-blue-600 p-3">
          <svg
            class="block h-4 w-4 fill-current"
            viewBox="0 0 20 20"
            xmlns="http://www.w3.org/2000/svg"
          >
            <title>Mobile menu</title>
            <path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"></path>
          </svg>
        </button>
      </div>
      <a
        class="hidden lg:inline-block lg:ml-auto lg:mr-3 py-2 px-6 bg-gray-50 hover:bg-gray-100 text-sm text-gray-900 font-bold rounded-xl transition duration-200"
        href="index.html"
        >Home</a
      >
      &nbsp;

      <a
        class="hidden lg:inline-block py-2 px-6 bg-blue-500 hover:bg-blue-600 text-sm text-white font-bold rounded-xl transition duration-200"
        href="#atn"
        >Attendance</a
      >
    </nav>
    <div class="navbar-menu relative z-50 hidden">
      <div class="navbar-backdrop fixed inset-0 bg-gray-800 opacity-25"></div>
      <nav
        class="fixed top-0 left-0 bottom-0 flex flex-col w-5/6 max-w-sm py-6 px-6 bg-white border-r overflow-y-auto"
      >
        <div class="flex items-center mb-8">
          <img class="w-16 rounded-full" src="logo.png" alt="Dhavya" />
          &nbsp;&nbsp;&nbsp; &nbsp; &nbsp;
          <a href="index.html" class="flex items-center">
            <span
              class="self-center whitespace-nowrap text-2xl font-semibold text-transparent bg-clip-text bg-gradient-to-r to-emerald-600 from-sky-400"
              >PIPM</span
            >
          </a>
          &nbsp;&nbsp;&nbsp;&nbsp;
          <button class="navbar-close">
            <svg
              class="h-6 w-6 text-gray-400 cursor-pointer hover:text-gray-500"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              ></path>
            </svg>
          </button>
        </div>
        <div>
          <ul>
            <li class="mb-1">
              <a
                class="block p-4 text-sm font-semibold text-gray-400 hover:bg-blue-50 hover:text-blue-600 rounded"
                href="index.html"
                >Home</a
              >
            </li>

            <li class="mb-1">
              <a
                class="block p-4 text-sm font-semibold text-gray-400 hover:bg-blue-50 hover:text-blue-600 rounded"
                href="#atn"
                >Attendance</a
              >
            </li>
          </ul>
        </div>

        <p class="my-4 text-xs text-center text-gray-400">
          <span>
            <span>Copyright Â© 2025</span> &nbsp; Developed Aghora
            Innovation</span
          >
        </p>
      </nav>
    </div>

    <!-- Typewriter effect  -->
    <div class="w-full h-full flex justify-center items-center">
      <h2>
        <span
          class="text-3xl font-bold from-30% from-[#FF8E26] to-55% to-[#0163E0] inline-block bg-gradient-to-r bg-clip-text text-transparent"
          id="typewriter"
        >
        </span>
      </h2>
    </div>
    <script>
      const words = ["Jai Sri Ram", "Welcome to", " PIPM Attendance system"];
      let i = 0;
      let j = 0;
      let currentWord = "";
      let isDeleting = false;

      function type() {
        currentWord = words[i];
        if (isDeleting) {
          document.getElementById("typewriter").textContent =
            currentWord.substring(0, j - 1);
          j--;
          if (j == 0) {
            isDeleting = false;
            i++;
            if (i == words.length) {
              i = 0;
            }
          }
        } else {
          document.getElementById("typewriter").textContent =
            currentWord.substring(0, j + 1);
          j++;
          if (j == currentWord.length) {
            isDeleting = true;
          }
        }
        setTimeout(type, 100);
      }
      type();
    </script>
    <br />
    <div class="bg-gray-100 p-6">
      <div class="max-w-4xl mx-auto bg-white p-6 rounded shadow">
        <h1 class="text-2xl font-bold mb-4">Attendance Form</h1>

        <form id="attendanceForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <input
            type="text"
            id="name"
            placeholder="Name"
            class="border p-2 rounded"
            required
          />
          <input
            type="text"
            id="uniqueId"
            placeholder="Unique ID"
            class="border p-2 rounded"
            required
          />
          <input
            type="tel"
            id="mobile"
            placeholder="Mobile Number"
            class="border p-2 rounded"
            required
          />

          <div class="col-span-1 md:col-span-2">
            <video
              id="webcam"
              autoplay
              class="border rounded w-full max-h-64"
            ></video>
          </div>

          <div class="col-span-1 md:col-span-2 flex items-center gap-4">
            <button
              type="button"
              onclick="captureImage()"
              class="bg-blue-500 text-white px-4 py-2 rounded"
            >
              Capture Image
            </button>
            <button
              type="submit"
              class="bg-green-500 text-white px-4 py-2 rounded"
            >
              Submit
            </button>
            <button
              type="button"
              onclick="exportToCSV()"
              class="bg-yellow-500 text-white px-4 py-2 rounded"
            >
              Export to CSV
            </button>
          </div>

          <canvas id="canvas" class="hidden"></canvas>
        </form>
      </div>

      <div class="max-w-5xl mx-auto mt-8 bg-white p-6 rounded shadow">
        <h2 class="text-xl font-semibold mb-4">Attendance Records</h2>
        <div class="overflow-x-auto">
          <table class="min-w-full border">
            <thead>
              <tr class="bg-gray-200">
                <th class="border px-4 py-2">Name</th>
                <th class="border px-4 py-2">Unique ID</th>
                <th class="border px-4 py-2">Mobile</th>
                <th class="border px-4 py-2">Image</th>
                <th class="border px-4 py-2">Actions</th>
              </tr>
            </thead>
            <tbody id="dataTable" class="text-center"></tbody>
          </table>
        </div>
      </div>
    </div>

    <script>
      const video = document.getElementById("webcam");
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
      let currentImageData = "";

      function startWebcam() {
        navigator.mediaDevices
          .getUserMedia({ video: true })
          .then((stream) => {
            video.srcObject = stream;
          })
          .catch((error) => {
            console.error("Webcam error:", error);
            alert("Could not access the webcam. Please allow camera access.");
          });
      }

      function captureImage() {
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        currentImageData = canvas.toDataURL("image/png");
      }

      function loadFromLocalStorage() {
        const saved = JSON.parse(localStorage.getItem("attendanceData")) || [];
        saved.forEach((data) => addRowToTable(data));
      }

      function saveToLocalStorage(entry) {
        const existing =
          JSON.parse(localStorage.getItem("attendanceData")) || [];
        existing.push(entry);
        localStorage.setItem("attendanceData", JSON.stringify(existing));
      }

      document
        .getElementById("attendanceForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const name = document.getElementById("name").value.trim();
          const uniqueId = document.getElementById("uniqueId").value.trim();
          const mobile = document.getElementById("mobile").value.trim();

          if (!currentImageData) {
            alert("Please capture an image first.");
            return;
          }

          const entry = { name, uniqueId, mobile, image: currentImageData };
          addRowToTable(entry);
          saveToLocalStorage(entry);

          this.reset();
          currentImageData = "";
        });

      function addRowToTable(entry) {
        const row = document.createElement("tr");
        row.innerHTML = `
              <td class="border px-4 py-2">${entry.name}</td>
              <td class="border px-4 py-2">${entry.uniqueId}</td>
              <td class="border px-4 py-2">${entry.mobile}</td>
              <td class="border px-4 py-2">
                <img src="${entry.image}" alt="Captured" class="w-16 h-16 object-cover mx-auto rounded"/>
              </td>
              <td class="border px-4 py-2">
                <button onclick="saveRow(this)" class="bg-blue-500 text-white px-2 py-1 rounded">Save</button>
                <button onclick="deleteRow(this)" class="bg-red-500 text-white px-2 py-1 rounded ml-2">Delete</button>
              </td>
            `;
        document.getElementById("dataTable").appendChild(row);
      }

      function saveRow(button) {
        alert("Record saved successfully!");
      }

      //   function deleteRow(button) {
      //     const row = button.closest("tr");
      //     const index = [...row.parentNode.children].indexOf(row);

      //     row.remove();

      //     // Update localStorage after deletion
      //     const saved = JSON.parse(localStorage.getItem("attendanceData")) || [];
      //     saved.splice(index, 1);
      //     localStorage.setItem("attendanceData", JSON.stringify(saved));
      //   }

      function exportToCSV() {
        const saved = JSON.parse(localStorage.getItem("attendanceData")) || [];
        if (!saved.length) return alert("No data to export!");

        const csvRows = [
          ["Name", "Unique ID", "Mobile", "Image Base64 (Data URL)"],
        ];

        saved.forEach(({ name, uniqueId, mobile, image }) => {
          csvRows.push([name, uniqueId, mobile, image]);
        });

        const csvContent = csvRows
          .map((row) =>
            row.map((cell) => `"${cell.replace(/"/g, '""')}"`).join(",")
          )
          .join("\n");

        const blob = new Blob([csvContent], { type: "text/csv" });
        const url = URL.createObjectURL(blob);

        const a = document.createElement("a");
        a.href = url;
        a.download = "attendance_data.csv";
        a.click();
        URL.revokeObjectURL(url);
      }

      window.onload = () => {
        startWebcam();
        loadFromLocalStorage();
      };
    </script>
  </body>
</html>
